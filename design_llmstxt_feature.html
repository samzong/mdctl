<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mdctl 的 llmstxt 功能设计文档 mdctl</title>
    <meta name="description" content="为 mdctl 工具添加llmstxt子命令，用于将网站的sitemap.xml转换为llms.txt文件。llms.txt是一个包含网站页面列表的 Markdown 格式文件，专为训练或微调大语言模型(LLMs)准备内容而设计。">
    <meta name="keywords" content="Markdown processor,CLI tool,Image downloader,Markdown translator,AI translation,Markdown automation,Remote image handling,Markdown utilities,AI-powered Markdown,Markdown enhancement,Markdown file management">
    <link rel="stylesheet" type="text/css" href="css/main.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/tocbot.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/media.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/sidebar.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/copy.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/demo-preview.css?v=1.34.1">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <script src="js/copy.js?v=1.34.1"></script>
    <script src="js/dark-mode.js?v=1.34.1"></script>
    <script src="js/markdown-style.js?v=1.34.1"></script>
  </head>
  <body id="idoctotop"><a href="#idoctotop" class="gototop">top</a>
    <header class="header">
      <article class="inner warpper" style="max-width:720px;"><a class="logo" href="index.html"><img alt="mdctl logo" src="assets/icon.png">
<span class="title">mdctl</span></a>
        <div class="content">
          <ul class="menu">
            <li><a href="index.html" target="" class="">Home</a></li>
            <li><a href="https://github.com/samzong" target="__blank" class="">About</a></li>
          </ul><a href="https://github.com/samzong/mdctl" target="_blank" rel="noopener noreferrer" title="Github" name="Github" class="github"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg></a>
          <dark-mode permanent=""></dark-mode>
        </div>
      </article>
    </header>
    <div style="max-width:720px;" class="warpper-content warpper notocs">
      <markdown-style theme-auto-switch-disabled="">
        <h1 id="mdctl-的-llmstxt-功能设计文档"><a aria-hidden="true" tabindex="-1" href="#mdctl-的-llmstxt-功能设计文档" class="anchor"><span class="icon icon-link"></span></a>mdctl 的 llmstxt 功能设计文档</h1>
        <h2 id="功能概述"><a aria-hidden="true" tabindex="-1" href="#功能概述" class="anchor"><span class="icon icon-link"></span></a>功能概述</h2>
        <p>为 mdctl 工具添加<code>llmstxt</code>子命令，用于将网站的<code>sitemap.xml</code>转换为<code>llms.txt</code>文件。<code>llms.txt</code>是一个包含网站页面列表的 Markdown 格式文件，专为训练或微调大语言模型(LLMs)准备内容而设计。</p>
        <p>该功能支持两种模式：</p>
        <ol>
          <li><strong>标准模式</strong>：仅提取页面标题和描述信息，生成<code>llms.txt</code></li>
          <li><strong>全文模式</strong>：除了标题和描述外，还提取页面正文内容，生成<code>llms-full.txt</code></li>
        </ol>
        <p>通过提供网站的 sitemap.xml URL，自动爬取页面内容，并生成结构化的 Markdown 文档，使其易于被用于 AI 模型的训练或微调。</p>
        <h2 id="用户需求"><a aria-hidden="true" tabindex="-1" href="#用户需求" class="anchor"><span class="icon icon-link"></span></a>用户需求</h2>
        <ol>
          <li>支持从网站的 sitemap.xml 中获取所有 URL</li>
          <li>访问每个 URL 并提取页面标题和描述</li>
          <li>可选择提取页面正文内容（全文模式）</li>
          <li>按页面路径的第一段分组内容，形成章节结构</li>
          <li>生成格式化的 Markdown 文档</li>
          <li>支持包含/排除特定路径</li>
          <li>提供详细的处理日志和错误信息</li>
        </ol>
        <h2 id="命令设计"><a aria-hidden="true" tabindex="-1" href="#命令设计" class="anchor"><span class="icon icon-link"></span></a>命令设计</h2>
        <pre><code class="code-highlight"><span class="code-line line-number" line="1">mdctl llmstxt [flags] &#x3C;url>
</span></code><input type="hidden" value="mdctl llmstxt [flags] <url>
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="参数设计"><a aria-hidden="true" tabindex="-1" href="#参数设计" class="anchor"><span class="icon icon-link"></span></a>参数设计</h3>
        <ul>
          <li><code>&#x3C;url></code>：sitemap.xml 的 URL (必填参数)</li>
          <li><code>-i, --include-path</code>：包含的路径模式，支持 glob 语法 (可多次指定)</li>
          <li><code>-e, --exclude-path</code>：排除的路径模式，支持 glob 语法 (可多次指定)</li>
          <li><code>-o, --output</code>：输出文件路径 (默认：标准输出)</li>
          <li><code>-f, --full</code>：启用全文模式，提取页面正文内容 (默认：false)</li>
          <li><code>-c, --concurrency</code>：并发请求数量 (默认：5)</li>
          <li><code>--timeout</code>：请求超时时间，单位秒 (默认：30)</li>
          <li><code>--verbose</code>：启用详细日志输出 (默认：false)</li>
        </ul>
        <h3 id="使用示例"><a aria-hidden="true" tabindex="-1" href="#使用示例" class="anchor"><span class="icon icon-link"></span></a>使用示例</h3>
        <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line line-number" line="1"><span class="token comment"># 基本用法（标准模式）</span>
</span><span class="code-line line-number" line="2">mdctl llmstxt https://example.com/sitemap.xml <span class="token operator">></span> llms.txt
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token comment"># 全文模式</span>
</span><span class="code-line line-number" line="5">mdctl llmstxt <span class="token parameter variable">-f</span> https://example.com/sitemap.xml <span class="token operator">></span> llms-full.txt
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token comment"># 指定输出文件</span>
</span><span class="code-line line-number" line="8">mdctl llmstxt https://example.com/sitemap.xml <span class="token parameter variable">-o</span> llms.txt
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10"><span class="token comment"># 排除特定路径</span>
</span><span class="code-line line-number" line="11">mdctl llmstxt https://example.com/sitemap.xml <span class="token parameter variable">-e</span> <span class="token string">"**/blog/**"</span> <span class="token parameter variable">-e</span> <span class="token string">"**/privacy**"</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token comment"># 只包含特定路径</span>
</span><span class="code-line line-number" line="14">mdctl llmstxt https://example.com/sitemap.xml <span class="token parameter variable">-i</span> <span class="token string">"**/docs/**"</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16"><span class="token comment"># 调整并发请求数量</span>
</span><span class="code-line line-number" line="17">mdctl llmstxt https://example.com/sitemap.xml <span class="token parameter variable">-c</span> <span class="token number">10</span>
</span><span class="code-line line-number" line="18">
</span><span class="code-line line-number" line="19"><span class="token comment"># 启用详细日志</span>
</span><span class="code-line line-number" line="20">mdctl llmstxt https://example.com/sitemap.xml <span class="token parameter variable">--verbose</span>
</span></code><input type="hidden" value="# 基本用法（标准模式）
mdctl llmstxt https://example.com/sitemap.xml > llms.txt

# 全文模式
mdctl llmstxt -f https://example.com/sitemap.xml > llms-full.txt

# 指定输出文件
mdctl llmstxt https://example.com/sitemap.xml -o llms.txt

# 排除特定路径
mdctl llmstxt https://example.com/sitemap.xml -e &#x22;**/blog/**&#x22; -e &#x22;**/privacy**&#x22;

# 只包含特定路径
mdctl llmstxt https://example.com/sitemap.xml -i &#x22;**/docs/**&#x22;

# 调整并发请求数量
mdctl llmstxt https://example.com/sitemap.xml -c 10

# 启用详细日志
mdctl llmstxt https://example.com/sitemap.xml --verbose
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="实现设计"><a aria-hidden="true" tabindex="-1" href="#实现设计" class="anchor"><span class="icon icon-link"></span></a>实现设计</h2>
        <h3 id="整体架构"><a aria-hidden="true" tabindex="-1" href="#整体架构" class="anchor"><span class="icon icon-link"></span></a>整体架构</h3>
        <p>按照 mdctl 的现有结构，在<code>cmd/</code>目录下创建<code>llmstxt.go</code>文件定义命令接口，在<code>internal/</code>目录下创建<code>llmstxt/</code>模块实现具体功能。</p>
        <pre><code class="code-highlight"><span class="code-line line-number" line="1">mdctl/
</span><span class="code-line line-number" line="2">├── cmd/
</span><span class="code-line line-number" line="3">│   └── llmstxt.go       # 新增：llmstxt命令定义
</span><span class="code-line line-number" line="4">├── internal/
</span><span class="code-line line-number" line="5">│   └── llmstxt/         # 新增：llmstxt功能实现
</span><span class="code-line line-number" line="6">│       ├── generator.go  # 生成器核心实现
</span><span class="code-line line-number" line="7">│       ├── sitemap.go    # Sitemap解析器
</span><span class="code-line line-number" line="8">│       ├── fetcher.go    # 网页内容获取
</span><span class="code-line line-number" line="9">│       ├── extractor.go  # 页面标题、描述和正文提取器
</span><span class="code-line line-number" line="10">│       └── formatter.go  # Markdown格式生成
</span></code><input type="hidden" value="mdctl/
├── cmd/
│   └── llmstxt.go       # 新增：llmstxt命令定义
├── internal/
│   └── llmstxt/         # 新增：llmstxt功能实现
│       ├── generator.go  # 生成器核心实现
│       ├── sitemap.go    # Sitemap解析器
│       ├── fetcher.go    # 网页内容获取
│       ├── extractor.go  # 页面标题、描述和正文提取器
│       └── formatter.go  # Markdown格式生成
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="核心组件"><a aria-hidden="true" tabindex="-1" href="#核心组件" class="anchor"><span class="icon icon-link"></span></a>核心组件</h3>
        <h4 id="1-命令处理器-cmdllmstxtgo"><a aria-hidden="true" tabindex="-1" href="#1-命令处理器-cmdllmstxtgo" class="anchor"><span class="icon icon-link"></span></a>1. 命令处理器 (cmd/llmstxt.go)</h4>
        <p>负责解析命令行参数并调用 llmstxt 功能。</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">var</span> <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">    includePaths     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
</span><span class="code-line line-number" line="3">    excludePaths     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
</span><span class="code-line line-number" line="4">    outputPath       <span class="token builtin">string</span>
</span><span class="code-line line-number" line="5">    fullMode         <span class="token builtin">bool</span>
</span><span class="code-line line-number" line="6">    concurrency      <span class="token builtin">int</span>
</span><span class="code-line line-number" line="7">    timeout          <span class="token builtin">int</span>
</span><span class="code-line line-number" line="8">    verbose          <span class="token builtin">bool</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10">    llmstxtCmd <span class="token operator">=</span> <span class="token operator">&#x26;</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">        Use<span class="token punctuation">:</span>   <span class="token string">"llmstxt [url]"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="12">        Short<span class="token punctuation">:</span> <span class="token string">"Generate llms.txt from sitemap.xml"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="13">        Long<span class="token punctuation">:</span>  <span class="token string">`Generate a llms.txt file from a website's sitemap.xml. This file is a curated list of the website's pages in markdown format, perfect for training or fine-tuning language models.
</span></span><span class="code-line line-number" line="14"><span class="token string">
</span></span><span class="code-line line-number" line="15"><span class="token string">In standard mode, only title and description are extracted. In full mode (-f flag), the content of each page is also extracted.`</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="16">        Args<span class="token punctuation">:</span>  cobra<span class="token punctuation">.</span><span class="token function">ExactArgs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="17">        RunE<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">            sitemapURL <span class="token operator">:=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number" line="20">            <span class="token comment">// 创建生成器并配置选项</span>
</span><span class="code-line line-number" line="21">            config <span class="token operator">:=</span> llmstxt<span class="token punctuation">.</span>GeneratorConfig<span class="token punctuation">{</span>
</span><span class="code-line line-number" line="22">                SitemapURL<span class="token punctuation">:</span>    sitemapURL<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="23">                IncludePaths<span class="token punctuation">:</span>  includePaths<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="24">                ExcludePaths<span class="token punctuation">:</span>  excludePaths<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="25">                FullMode<span class="token punctuation">:</span>      fullMode<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="26">                Concurrency<span class="token punctuation">:</span>   concurrency<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="27">                Timeout<span class="token punctuation">:</span>       timeout<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="28">                UserAgent<span class="token punctuation">:</span>     <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="29">                Verbose<span class="token punctuation">:</span>       verbose<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="30">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="31">
</span><span class="code-line line-number" line="32">            generator <span class="token operator">:=</span> llmstxt<span class="token punctuation">.</span><span class="token function">NewGenerator</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="33">
</span><span class="code-line line-number" line="34">            <span class="token comment">// 执行生成</span>
</span><span class="code-line line-number" line="35">            content<span class="token punctuation">,</span> err <span class="token operator">:=</span> generator<span class="token punctuation">.</span><span class="token function">Generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="36">            <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="37">                <span class="token keyword">return</span> err
</span><span class="code-line line-number" line="38">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="39">
</span><span class="code-line line-number" line="40">            <span class="token comment">// 输出内容</span>
</span><span class="code-line line-number" line="41">            <span class="token keyword">if</span> outputPath <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="42">                <span class="token comment">// 输出到标准输出</span>
</span><span class="code-line line-number" line="43">                fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="44">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="45">                <span class="token comment">// 输出到文件</span>
</span><span class="code-line line-number" line="46">                <span class="token keyword">return</span> os<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>outputPath<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="47">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="48">
</span><span class="code-line line-number" line="49">            <span class="token keyword">return</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="50">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="51">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="52"><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="53">
</span><span class="code-line line-number" line="54"><span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="55">    llmstxtCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">StringVarP</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>outputPath<span class="token punctuation">,</span> <span class="token string">"output"</span><span class="token punctuation">,</span> <span class="token string">"o"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"Output file path (default: stdout)"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="56">    llmstxtCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">StringSliceVarP</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>includePaths<span class="token punctuation">,</span> <span class="token string">"include-path"</span><span class="token punctuation">,</span> <span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"Glob patterns for paths to include (can be specified multiple times)"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="57">    llmstxtCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">StringSliceVarP</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>excludePaths<span class="token punctuation">,</span> <span class="token string">"exclude-path"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"Glob patterns for paths to exclude (can be specified multiple times)"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="58">    llmstxtCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">BoolVarP</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>fullMode<span class="token punctuation">,</span> <span class="token string">"full"</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"Enable full-content mode (extract page content)"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="59">    llmstxtCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IntVarP</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>concurrency<span class="token punctuation">,</span> <span class="token string">"concurrency"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"Number of concurrent requests"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="60">    llmstxtCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IntVar</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>timeout<span class="token punctuation">,</span> <span class="token string">"timeout"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">"Request timeout in seconds"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="61">    llmstxtCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">BoolVar</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>verbose<span class="token punctuation">,</span> <span class="token string">"verbose"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"Enable verbose logging"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="62">
</span><span class="code-line line-number" line="63">    <span class="token comment">// 将命令添加到核心命令组</span>
</span><span class="code-line line-number" line="64">    llmstxtCmd<span class="token punctuation">.</span>GroupID <span class="token operator">=</span> <span class="token string">"core"</span>
</span><span class="code-line line-number" line="65"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="var (
    includePaths     []string
    excludePaths     []string
    outputPath       string
    fullMode         bool
    concurrency      int
    timeout          int
    verbose          bool

    llmstxtCmd = &#x26;cobra.Command{
        Use:   &#x22;llmstxt [url]&#x22;,
        Short: &#x22;Generate llms.txt from sitemap.xml&#x22;,
        Long:  &#x60;Generate a llms.txt file from a website&#x27;s sitemap.xml. This file is a curated list of the website&#x27;s pages in markdown format, perfect for training or fine-tuning language models.

In standard mode, only title and description are extracted. In full mode (-f flag), the content of each page is also extracted.&#x60;,
        Args:  cobra.ExactArgs(1),
        RunE: func(cmd *cobra.Command, args []string) error {
            sitemapURL := args[0]

            // 创建生成器并配置选项
            config := llmstxt.GeneratorConfig{
                SitemapURL:    sitemapURL,
                IncludePaths:  includePaths,
                ExcludePaths:  excludePaths,
                FullMode:      fullMode,
                Concurrency:   concurrency,
                Timeout:       timeout,
                UserAgent:     &#x22;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36&#x22;,
                Verbose:       verbose,
            }

            generator := llmstxt.NewGenerator(config)

            // 执行生成
            content, err := generator.Generate()
            if err != nil {
                return err
            }

            // 输出内容
            if outputPath == &#x22;&#x22; {
                // 输出到标准输出
                fmt.Println(content)
            } else {
                // 输出到文件
                return os.WriteFile(outputPath, []byte(content), 0644)
            }

            return nil
        },
    }
)

func init() {
    llmstxtCmd.Flags().StringVarP(&#x26;outputPath, &#x22;output&#x22;, &#x22;o&#x22;, &#x22;&#x22;, &#x22;Output file path (default: stdout)&#x22;)
    llmstxtCmd.Flags().StringSliceVarP(&#x26;includePaths, &#x22;include-path&#x22;, &#x22;i&#x22;, []string{}, &#x22;Glob patterns for paths to include (can be specified multiple times)&#x22;)
    llmstxtCmd.Flags().StringSliceVarP(&#x26;excludePaths, &#x22;exclude-path&#x22;, &#x22;e&#x22;, []string{}, &#x22;Glob patterns for paths to exclude (can be specified multiple times)&#x22;)
    llmstxtCmd.Flags().BoolVarP(&#x26;fullMode, &#x22;full&#x22;, &#x22;f&#x22;, false, &#x22;Enable full-content mode (extract page content)&#x22;)
    llmstxtCmd.Flags().IntVarP(&#x26;concurrency, &#x22;concurrency&#x22;, &#x22;c&#x22;, 5, &#x22;Number of concurrent requests&#x22;)
    llmstxtCmd.Flags().IntVar(&#x26;timeout, &#x22;timeout&#x22;, 30, &#x22;Request timeout in seconds&#x22;)
    llmstxtCmd.Flags().BoolVar(&#x26;verbose, &#x22;verbose&#x22;, false, &#x22;Enable verbose logging&#x22;)

    // 将命令添加到核心命令组
    llmstxtCmd.GroupID = &#x22;core&#x22;
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="2-生成器-internalllmstxtgeneratorgo"><a aria-hidden="true" tabindex="-1" href="#2-生成器-internalllmstxtgeneratorgo" class="anchor"><span class="icon icon-link"></span></a>2. 生成器 (internal/llmstxt/generator.go)</h4>
        <p>负责协调整个生成过程的核心组件。</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// GeneratorConfig 包含生成llms.txt所需的配置</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">type</span> GeneratorConfig <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    SitemapURL    <span class="token builtin">string</span>
</span><span class="code-line line-number" line="4">    IncludePaths  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
</span><span class="code-line line-number" line="5">    ExcludePaths  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
</span><span class="code-line line-number" line="6">    FullMode      <span class="token builtin">bool</span>
</span><span class="code-line line-number" line="7">    Concurrency   <span class="token builtin">int</span>
</span><span class="code-line line-number" line="8">    Timeout       <span class="token builtin">int</span>
</span><span class="code-line line-number" line="9">    UserAgent     <span class="token builtin">string</span>
</span><span class="code-line line-number" line="10">    Verbose       <span class="token builtin">bool</span>
</span><span class="code-line line-number" line="11"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token comment">// PageInfo 存储页面的信息</span>
</span><span class="code-line line-number" line="14"><span class="token keyword">type</span> PageInfo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="15">    Title       <span class="token builtin">string</span>
</span><span class="code-line line-number" line="16">    URL         <span class="token builtin">string</span>
</span><span class="code-line line-number" line="17">    Description <span class="token builtin">string</span>
</span><span class="code-line line-number" line="18">    Content     <span class="token builtin">string</span>    <span class="token comment">// 页面正文内容，仅在全文模式下填充</span>
</span><span class="code-line line-number" line="19">    Section     <span class="token builtin">string</span>    <span class="token comment">// 从URL路径提取的第一段作为章节</span>
</span><span class="code-line line-number" line="20"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22"><span class="token comment">// Generator 是llms.txt生成器</span>
</span><span class="code-line line-number" line="23"><span class="token keyword">type</span> Generator <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="24">    config GeneratorConfig
</span><span class="code-line line-number" line="25">    logger <span class="token operator">*</span>log<span class="token punctuation">.</span>Logger
</span><span class="code-line line-number" line="26"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="27">
</span><span class="code-line line-number" line="28"><span class="token comment">// NewGenerator 创建一个新的生成器实例</span>
</span><span class="code-line line-number" line="29"><span class="token keyword">func</span> <span class="token function">NewGenerator</span><span class="token punctuation">(</span>config GeneratorConfig<span class="token punctuation">)</span> <span class="token operator">*</span>Generator <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="30">    <span class="token keyword">var</span> logger <span class="token operator">*</span>log<span class="token punctuation">.</span>Logger
</span><span class="code-line line-number" line="31">    <span class="token keyword">if</span> config<span class="token punctuation">.</span>Verbose <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="32">        logger <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> <span class="token string">"[LLMSTXT] "</span><span class="token punctuation">,</span> log<span class="token punctuation">.</span>LstdFlags<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="33">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="34">        logger <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>Discard<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="35">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="36">
</span><span class="code-line line-number" line="37">    <span class="token keyword">return</span> <span class="token operator">&#x26;</span>Generator<span class="token punctuation">{</span>
</span><span class="code-line line-number" line="38">        config<span class="token punctuation">:</span> config<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="39">        logger<span class="token punctuation">:</span> logger<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="40">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="41"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="42">
</span><span class="code-line line-number" line="43"><span class="token comment">// Generate 执行生成过程并返回生成的内容</span>
</span><span class="code-line line-number" line="44"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Generator<span class="token punctuation">)</span> <span class="token function">Generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="45">    g<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Starting generation for sitemap: %s"</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>SitemapURL<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="46">    <span class="token keyword">if</span> g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>FullMode <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="47">        g<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Full-content mode enabled"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="48">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="49">
</span><span class="code-line line-number" line="50">    <span class="token comment">// 1. 解析sitemap.xml获取URL列表</span>
</span><span class="code-line line-number" line="51">    urls<span class="token punctuation">,</span> err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">parseSitemap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="52">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="53">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"failed to parse sitemap: %w"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="54">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="55">    g<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Found %d URLs in sitemap"</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="56">
</span><span class="code-line line-number" line="57">    <span class="token comment">// 2. 过滤URL（基于include/exclude模式）</span>
</span><span class="code-line line-number" line="58">    urls <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">filterURLs</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="59">    g<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d URLs after filtering"</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="60">
</span><span class="code-line line-number" line="61">    <span class="token comment">// 3. 创建工作池并获取页面信息</span>
</span><span class="code-line line-number" line="62">    pages<span class="token punctuation">,</span> err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">fetchPages</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="63">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="64">        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"failed to fetch pages: %w"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="65">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="66">
</span><span class="code-line line-number" line="67">    <span class="token comment">// 4. 按章节分组页面信息</span>
</span><span class="code-line line-number" line="68">    sections <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">groupBySections</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="69">
</span><span class="code-line line-number" line="70">    <span class="token comment">// 5. 格式化为Markdown内容</span>
</span><span class="code-line line-number" line="71">    content <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">formatContent</span><span class="token punctuation">(</span>sections<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="72">
</span><span class="code-line line-number" line="73">    g<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Generation completed successfully"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="74">    <span class="token keyword">return</span> content<span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="75"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="76">
</span><span class="code-line line-number" line="77"><span class="token comment">// 其他私有方法实现具体功能...</span>
</span></code><input type="hidden" value="// GeneratorConfig 包含生成llms.txt所需的配置
type GeneratorConfig struct {
    SitemapURL    string
    IncludePaths  []string
    ExcludePaths  []string
    FullMode      bool
    Concurrency   int
    Timeout       int
    UserAgent     string
    Verbose       bool
}

// PageInfo 存储页面的信息
type PageInfo struct {
    Title       string
    URL         string
    Description string
    Content     string    // 页面正文内容，仅在全文模式下填充
    Section     string    // 从URL路径提取的第一段作为章节
}

// Generator 是llms.txt生成器
type Generator struct {
    config GeneratorConfig
    logger *log.Logger
}

// NewGenerator 创建一个新的生成器实例
func NewGenerator(config GeneratorConfig) *Generator {
    var logger *log.Logger
    if config.Verbose {
        logger = log.New(os.Stdout, &#x22;[LLMSTXT] &#x22;, log.LstdFlags)
    } else {
        logger = log.New(io.Discard, &#x22;&#x22;, 0)
    }

    return &#x26;Generator{
        config: config,
        logger: logger,
    }
}

// Generate 执行生成过程并返回生成的内容
func (g *Generator) Generate() (string, error) {
    g.logger.Printf(&#x22;Starting generation for sitemap: %s&#x22;, g.config.SitemapURL)
    if g.config.FullMode {
        g.logger.Println(&#x22;Full-content mode enabled&#x22;)
    }

    // 1. 解析sitemap.xml获取URL列表
    urls, err := g.parseSitemap()
    if err != nil {
        return &#x22;&#x22;, fmt.Errorf(&#x22;failed to parse sitemap: %w&#x22;, err)
    }
    g.logger.Printf(&#x22;Found %d URLs in sitemap&#x22;, len(urls))

    // 2. 过滤URL（基于include/exclude模式）
    urls = g.filterURLs(urls)
    g.logger.Printf(&#x22;%d URLs after filtering&#x22;, len(urls))

    // 3. 创建工作池并获取页面信息
    pages, err := g.fetchPages(urls)
    if err != nil {
        return &#x22;&#x22;, fmt.Errorf(&#x22;failed to fetch pages: %w&#x22;, err)
    }

    // 4. 按章节分组页面信息
    sections := g.groupBySections(pages)

    // 5. 格式化为Markdown内容
    content := g.formatContent(sections)

    g.logger.Println(&#x22;Generation completed successfully&#x22;)
    return content, nil
}

// 其他私有方法实现具体功能...
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="3-sitemap-解析器-internalllmstxtsitemapgo"><a aria-hidden="true" tabindex="-1" href="#3-sitemap-解析器-internalllmstxtsitemapgo" class="anchor"><span class="icon icon-link"></span></a>3. Sitemap 解析器 (internal/llmstxt/sitemap.go)</h4>
        <p>负责解析 sitemap.xml 文件，获取所有 URL。</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// 解析sitemap.xml文件并返回所有URL</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Generator<span class="token punctuation">)</span> <span class="token function">parseSitemap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    g<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Parsing sitemap from %s"</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>SitemapURL<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token comment">// 使用适当的HTTP客户端配置（超时、自定义UA等）</span>
</span><span class="code-line line-number" line="6">    client <span class="token operator">:=</span> <span class="token operator">&#x26;</span>http<span class="token punctuation">.</span>Client<span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">        Timeout<span class="token punctuation">:</span> time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>Timeout<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10">    <span class="token comment">// 构建请求</span>
</span><span class="code-line line-number" line="11">    req<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>SitemapURL<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12">    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
</span><span class="code-line line-number" line="14">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16">    <span class="token comment">// 设置User-Agent</span>
</span><span class="code-line line-number" line="17">    req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>UserAgent<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="18">
</span><span class="code-line line-number" line="19">    <span class="token comment">// 实现sitemap解析逻辑</span>
</span><span class="code-line line-number" line="20">    <span class="token comment">// 支持标准的sitemap.xml格式和sitemap索引格式</span>
</span><span class="code-line line-number" line="21">    <span class="token comment">// 使用XML解析库解析响应内容</span>
</span><span class="code-line line-number" line="22">
</span><span class="code-line line-number" line="23">    <span class="token comment">// 返回解析出的URL列表</span>
</span><span class="code-line line-number" line="24"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="25">
</span><span class="code-line line-number" line="26"><span class="token comment">// 基于include/exclude模式过滤URL列表</span>
</span><span class="code-line line-number" line="27"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Generator<span class="token punctuation">)</span> <span class="token function">filterURLs</span><span class="token punctuation">(</span>urls <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="28">    <span class="token comment">// 实现URL过滤逻辑</span>
</span><span class="code-line line-number" line="29">    <span class="token comment">// 使用glob匹配实现include/exclude过滤</span>
</span><span class="code-line line-number" line="30">    <span class="token comment">// 返回过滤后的URL列表</span>
</span><span class="code-line line-number" line="31"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="// 解析sitemap.xml文件并返回所有URL
func (g *Generator) parseSitemap() ([]string, error) {
    g.logger.Printf(&#x22;Parsing sitemap from %s&#x22;, g.config.SitemapURL)

    // 使用适当的HTTP客户端配置（超时、自定义UA等）
    client := &#x26;http.Client{
        Timeout: time.Duration(g.config.Timeout) * time.Second,
    }

    // 构建请求
    req, err := http.NewRequest(&#x22;GET&#x22;, g.config.SitemapURL, nil)
    if err != nil {
        return nil, err
    }

    // 设置User-Agent
    req.Header.Set(&#x22;User-Agent&#x22;, g.config.UserAgent)

    // 实现sitemap解析逻辑
    // 支持标准的sitemap.xml格式和sitemap索引格式
    // 使用XML解析库解析响应内容

    // 返回解析出的URL列表
}

// 基于include/exclude模式过滤URL列表
func (g *Generator) filterURLs(urls []string) []string {
    // 实现URL过滤逻辑
    // 使用glob匹配实现include/exclude过滤
    // 返回过滤后的URL列表
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="4-页面获取器-internalllmstxtfetchergo"><a aria-hidden="true" tabindex="-1" href="#4-页面获取器-internalllmstxtfetchergo" class="anchor"><span class="icon icon-link"></span></a>4. 页面获取器 (internal/llmstxt/fetcher.go)</h4>
        <p>负责并发获取页面内容。</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// 使用工作池并发获取页面信息</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Generator<span class="token punctuation">)</span> <span class="token function">fetchPages</span><span class="token punctuation">(</span>urls <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>PageInfo<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    g<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Starting to fetch %d pages with concurrency %d"</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>Concurrency<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token comment">// 实现工作池进行并发请求</span>
</span><span class="code-line line-number" line="6">    <span class="token comment">// 使用信号量或工作池模式控制并发数量</span>
</span><span class="code-line line-number" line="7">    <span class="token comment">// 向每个页面发送HTTP请求并提取内容</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    <span class="token comment">// 返回所有页面信息</span>
</span><span class="code-line line-number" line="10"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="// 使用工作池并发获取页面信息
func (g *Generator) fetchPages(urls []string) ([]PageInfo, error) {
    g.logger.Printf(&#x22;Starting to fetch %d pages with concurrency %d&#x22;, len(urls), g.config.Concurrency)

    // 实现工作池进行并发请求
    // 使用信号量或工作池模式控制并发数量
    // 向每个页面发送HTTP请求并提取内容

    // 返回所有页面信息
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="5-内容提取器-internalllmstxtextractorgo"><a aria-hidden="true" tabindex="-1" href="#5-内容提取器-internalllmstxtextractorgo" class="anchor"><span class="icon icon-link"></span></a>5. 内容提取器 (internal/llmstxt/extractor.go)</h4>
        <p>负责从 HTML 页面中提取标题、描述和正文信息。</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// 从HTML内容中提取页面信息</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Generator<span class="token punctuation">)</span> <span class="token function">extractPageInfo</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">,</span> html <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>PageInfo<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token comment">// 使用HTML解析库（如goquery）提取页面标题和描述</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">    <span class="token keyword">var</span> pageInfo PageInfo
</span><span class="code-line line-number" line="6">    pageInfo<span class="token punctuation">.</span>URL <span class="token operator">=</span> url
</span><span class="code-line line-number" line="7">    pageInfo<span class="token punctuation">.</span>Section <span class="token operator">=</span> <span class="token function">parseSection</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    <span class="token comment">// 提取标题和描述</span>
</span><span class="code-line line-number" line="10">    <span class="token comment">// ...</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">    <span class="token comment">// 在全文模式下提取页面正文</span>
</span><span class="code-line line-number" line="13">    <span class="token keyword">if</span> g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>FullMode <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="14">        <span class="token comment">// 提取主要内容，去除导航、页眉页脚、广告等</span>
</span><span class="code-line line-number" line="15">        <span class="token comment">// 可使用启发式算法或基于DOM结构分析识别主要内容区域</span>
</span><span class="code-line line-number" line="16">        <span class="token comment">// 保留Markdown兼容的格式</span>
</span><span class="code-line line-number" line="17">        <span class="token comment">// ...</span>
</span><span class="code-line line-number" line="18">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number" line="20">    <span class="token keyword">return</span> pageInfo<span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="21"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="22">
</span><span class="code-line line-number" line="23"><span class="token comment">// 从URL中解析章节信息</span>
</span><span class="code-line line-number" line="24"><span class="token keyword">func</span> <span class="token function">parseSection</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="25">    <span class="token comment">// 从URL中提取路径部分第一段作为章节</span>
</span><span class="code-line line-number" line="26">    <span class="token comment">// ...</span>
</span><span class="code-line line-number" line="27"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="// 从HTML内容中提取页面信息
func (g *Generator) extractPageInfo(url string, html string) (PageInfo, error) {
    // 使用HTML解析库（如goquery）提取页面标题和描述

    var pageInfo PageInfo
    pageInfo.URL = url
    pageInfo.Section = parseSection(url)

    // 提取标题和描述
    // ...

    // 在全文模式下提取页面正文
    if g.config.FullMode {
        // 提取主要内容，去除导航、页眉页脚、广告等
        // 可使用启发式算法或基于DOM结构分析识别主要内容区域
        // 保留Markdown兼容的格式
        // ...
    }

    return pageInfo, nil
}

// 从URL中解析章节信息
func parseSection(url string) string {
    // 从URL中提取路径部分第一段作为章节
    // ...
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h4 id="6-markdown-格式化器-internalllmstxtformattergo"><a aria-hidden="true" tabindex="-1" href="#6-markdown-格式化器-internalllmstxtformattergo" class="anchor"><span class="icon icon-link"></span></a>6. Markdown 格式化器 (internal/llmstxt/formatter.go)</h4>
        <p>负责生成最终的 Markdown 内容。</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// 按章节分组页面信息</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Generator<span class="token punctuation">)</span> <span class="token function">groupBySections</span><span class="token punctuation">(</span>pages <span class="token punctuation">[</span><span class="token punctuation">]</span>PageInfo<span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>PageInfo <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token comment">// 实现章节分组逻辑</span>
</span><span class="code-line line-number" line="4">    <span class="token comment">// 返回章节到页面列表的映射</span>
</span><span class="code-line line-number" line="5"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token comment">// 格式化为Markdown内容</span>
</span><span class="code-line line-number" line="8"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Generator<span class="token punctuation">)</span> <span class="token function">formatContent</span><span class="token punctuation">(</span>sections <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>PageInfo<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">    <span class="token keyword">var</span> buf strings<span class="token punctuation">.</span>Builder
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">    <span class="token comment">// 找到根页面信息</span>
</span><span class="code-line line-number" line="12">    <span class="token keyword">var</span> rootPage PageInfo
</span><span class="code-line line-number" line="13">    <span class="token keyword">if</span> rootPages<span class="token punctuation">,</span> ok <span class="token operator">:=</span> sections<span class="token punctuation">[</span><span class="token string">"ROOT"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token operator">&#x26;&#x26;</span> <span class="token function">len</span><span class="token punctuation">(</span>rootPages<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="14">        rootPage <span class="token operator">=</span> rootPages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="15">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">    <span class="token comment">// 添加文档标题</span>
</span><span class="code-line line-number" line="18">    buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"# "</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="19">    buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>rootPage<span class="token punctuation">.</span>Title<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="20">    buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">    <span class="token comment">// 添加文档描述</span>
</span><span class="code-line line-number" line="23">    buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="24">    buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>rootPage<span class="token punctuation">.</span>Description<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="25">    buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="26">
</span><span class="code-line line-number" line="27">    <span class="token comment">// 处理每个章节</span>
</span><span class="code-line line-number" line="28">    <span class="token keyword">for</span> section<span class="token punctuation">,</span> pages <span class="token operator">:=</span> <span class="token keyword">range</span> sections <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="29">        <span class="token comment">// 跳过ROOT章节，因为它已经用于标题和描述</span>
</span><span class="code-line line-number" line="30">        <span class="token keyword">if</span> section <span class="token operator">==</span> <span class="token string">"ROOT"</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="31">            <span class="token keyword">continue</span>
</span><span class="code-line line-number" line="32">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="33">
</span><span class="code-line line-number" line="34">        <span class="token comment">// 添加章节标题</span>
</span><span class="code-line line-number" line="35">        buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"## "</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="36">        buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token function">capitalizeString</span><span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="37">        buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="38">
</span><span class="code-line line-number" line="39">        <span class="token comment">// 添加章节内每个页面的信息</span>
</span><span class="code-line line-number" line="40">        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> page <span class="token operator">:=</span> <span class="token keyword">range</span> pages <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="41">            buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"- ["</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="42">            buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>Title<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="43">            buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"]("</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="44">            buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>URL<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="45">            buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"): "</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="46">            buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>Description<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="47">            buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="48">
</span><span class="code-line line-number" line="49">            <span class="token comment">// 在全文模式下添加页面正文内容</span>
</span><span class="code-line line-number" line="50">            <span class="token keyword">if</span> g<span class="token punctuation">.</span>config<span class="token punctuation">.</span>FullMode <span class="token operator">&#x26;&#x26;</span> page<span class="token punctuation">.</span>Content <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="51">                buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="52">                buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>Content<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="53">                buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="54">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="55">
</span><span class="code-line line-number" line="56">            buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="57">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="58">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="59">
</span><span class="code-line line-number" line="60">    <span class="token keyword">return</span> buf<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="61"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="62">
</span><span class="code-line line-number" line="63"><span class="token comment">// 首字母大写，其余小写</span>
</span><span class="code-line line-number" line="64"><span class="token keyword">func</span> <span class="token function">capitalizeString</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="65">    <span class="token keyword">if</span> str <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="66">        <span class="token keyword">return</span> <span class="token string">""</span>
</span><span class="code-line line-number" line="67">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="68">
</span><span class="code-line line-number" line="69">    <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="70"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="// 按章节分组页面信息
func (g *Generator) groupBySections(pages []PageInfo) map[string][]PageInfo {
    // 实现章节分组逻辑
    // 返回章节到页面列表的映射
}

// 格式化为Markdown内容
func (g *Generator) formatContent(sections map[string][]PageInfo) string {
    var buf strings.Builder

    // 找到根页面信息
    var rootPage PageInfo
    if rootPages, ok := sections[&#x22;ROOT&#x22;]; ok &#x26;&#x26; len(rootPages) > 0 {
        rootPage = rootPages[0]
    }

    // 添加文档标题
    buf.WriteString(&#x22;# &#x22;)
    buf.WriteString(rootPage.Title)
    buf.WriteString(&#x22;\n\n&#x22;)

    // 添加文档描述
    buf.WriteString(&#x22;> &#x22;)
    buf.WriteString(rootPage.Description)
    buf.WriteString(&#x22;\n\n&#x22;)

    // 处理每个章节
    for section, pages := range sections {
        // 跳过ROOT章节，因为它已经用于标题和描述
        if section == &#x22;ROOT&#x22; {
            continue
        }

        // 添加章节标题
        buf.WriteString(&#x22;## &#x22;)
        buf.WriteString(capitalizeString(section))
        buf.WriteString(&#x22;\n\n&#x22;)

        // 添加章节内每个页面的信息
        for _, page := range pages {
            buf.WriteString(&#x22;- [&#x22;)
            buf.WriteString(page.Title)
            buf.WriteString(&#x22;](&#x22;)
            buf.WriteString(page.URL)
            buf.WriteString(&#x22;): &#x22;)
            buf.WriteString(page.Description)
            buf.WriteString(&#x22;\n&#x22;)

            // 在全文模式下添加页面正文内容
            if g.config.FullMode &#x26;&#x26; page.Content != &#x22;&#x22; {
                buf.WriteString(&#x22;\n&#x22;)
                buf.WriteString(page.Content)
                buf.WriteString(&#x22;\n&#x22;)
            }

            buf.WriteString(&#x22;\n&#x22;)
        }
    }

    return buf.String()
}

// 首字母大写，其余小写
func capitalizeString(str string) string {
    if str == &#x22;&#x22; {
        return &#x22;&#x22;
    }

    return strings.ToUpper(str[:1]) + strings.ToLower(str[1:])
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="工作流程"><a aria-hidden="true" tabindex="-1" href="#工作流程" class="anchor"><span class="icon icon-link"></span></a>工作流程</h3>
        <ol>
          <li><strong>命令解析</strong>：解析用户提供的命令行参数</li>
          <li><strong>Sitemap 解析</strong>：获取并解析网站的 sitemap.xml，提取所有 URL</li>
          <li><strong>URL 筛选</strong>：基于包含/排除规则过滤 URL 列表</li>
          <li><strong>内容获取</strong>：并发访问每个 URL，获取页面内容</li>
          <li><strong>信息提取</strong>：
            <ul>
              <li>从每个页面提取标题和描述</li>
              <li>在全文模式下，额外提取页面正文内容</li>
            </ul>
          </li>
          <li><strong>内容分组</strong>：按 URL 的第一段路径对内容进行分组</li>
          <li><strong>格式化输出</strong>：生成格式化的 Markdown 文档
            <ul>
              <li>标准模式：仅包含标题和描述</li>
              <li>全文模式：包含标题、描述和正文</li>
            </ul>
          </li>
          <li><strong>结果处理</strong>：将结果写入文件或输出到标准输出</li>
        </ol>
        <h3 id="路径处理和分组策略"><a aria-hidden="true" tabindex="-1" href="#路径处理和分组策略" class="anchor"><span class="icon icon-link"></span></a>路径处理和分组策略</h3>
        <ol>
          <li>
            <p><strong>路径解析</strong>：</p>
            <ul>
              <li>从 URL 中提取路径部分</li>
              <li>按照"/"分割路径，获取第一段作为章节名称</li>
              <li>根路径("/")被视为特殊章节"ROOT"</li>
            </ul>
          </li>
          <li>
            <p><strong>章节处理</strong>：</p>
            <ul>
              <li>章节名称会被格式化为首字母大写（其余小写）</li>
              <li>章节按字母顺序排序，但"ROOT"章节始终在最前面</li>
              <li>章节内的页面按 URL 路径长度排序（较短的优先）</li>
            </ul>
          </li>
        </ol>
        <h3 id="正文提取策略全文模式"><a aria-hidden="true" tabindex="-1" href="#正文提取策略全文模式" class="anchor"><span class="icon icon-link"></span></a>正文提取策略（全文模式）</h3>
        <p>在全文模式下，系统将使用以下策略提取页面正文内容：</p>
        <ol>
          <li>
            <p><strong>内容识别</strong>：</p>
            <ul>
              <li>使用启发式算法识别主要内容区域</li>
              <li>识别并排除导航栏、侧边栏、页眉页脚、广告等非主要内容</li>
              <li>优先提取带有特定 HTML 标签（如 article、main、content）的内容区域</li>
            </ul>
          </li>
          <li>
            <p><strong>清理和格式化</strong>：</p>
            <ul>
              <li>移除 HTML 标签，保留文本内容</li>
              <li>保持段落、标题、列表等结构</li>
              <li>保留图片引用的 Markdown 格式</li>
              <li>删除 JavaScript 代码块和其他非文本内容</li>
              <li>清理多余空白和换行</li>
            </ul>
          </li>
          <li>
            <p><strong>内容限制</strong>：</p>
            <ul>
              <li>限制正文长度，避免过长内容（默认限制为 10,000 字符）</li>
              <li>对超长内容进行智能截断，保持完整段落</li>
            </ul>
          </li>
        </ol>
        <h3 id="错误处理"><a aria-hidden="true" tabindex="-1" href="#错误处理" class="anchor"><span class="icon icon-link"></span></a>错误处理</h3>
        <ol>
          <li>
            <p><strong>Sitemap 解析错误</strong>：</p>
            <ul>
              <li>提供清晰的错误消息，指出 sitemap.xml 无法访问或格式无效</li>
              <li>支持常见的 sitemap 格式（XML、TXT、索引 sitemap 等）</li>
            </ul>
          </li>
          <li>
            <p><strong>HTTP 请求错误</strong>：</p>
            <ul>
              <li>页面请求失败时记录警告，但继续处理其他页面</li>
              <li>设置合理的超时，避免单个页面阻塞整个处理过程</li>
            </ul>
          </li>
          <li>
            <p><strong>内容提取错误</strong>：</p>
            <ul>
              <li>对于无法提取标题或描述的页面，使用 URL 或路径作为备选</li>
              <li>正文提取失败时，提供警告但不中断处理</li>
              <li>记录详细的警告信息，但不中断处理</li>
            </ul>
          </li>
        </ol>
        <h3 id="性能优化"><a aria-hidden="true" tabindex="-1" href="#性能优化" class="anchor"><span class="icon icon-link"></span></a>性能优化</h3>
        <ol>
          <li>
            <p><strong>并发请求</strong>：</p>
            <ul>
              <li>使用工作池模式控制并发数量</li>
              <li>默认并发数为 5，可通过参数调整</li>
            </ul>
          </li>
          <li>
            <p><strong>超时控制</strong>：</p>
            <ul>
              <li>为每个 HTTP 请求设置超时，避免长时间等待</li>
              <li>默认超时为 30 秒，可通过参数调整</li>
            </ul>
          </li>
          <li>
            <p><strong>内存优化</strong>：</p>
            <ul>
              <li>流式处理大型 sitemap，避免一次性加载所有 URL</li>
              <li>使用 strings.Builder 高效构建输出内容</li>
              <li>在处理大型站点时分批处理 URL，避免内存占用过高</li>
            </ul>
          </li>
        </ol>
        <h3 id="浏览器模拟"><a aria-hidden="true" tabindex="-1" href="#浏览器模拟" class="anchor"><span class="icon icon-link"></span></a>浏览器模拟</h3>
        <p>为了更好地获取页面内容，系统默认使用模拟 Chrome 浏览器的 User-Agent：</p>
        <pre><code class="code-highlight"><span class="code-line line-number" line="1">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36
</span></code><input type="hidden" value="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>这有助于：</p>
        <ol>
          <li>避免被网站检测为爬虫而阻止</li>
          <li>确保获取到与普通用户相同的页面内容</li>
          <li>提高内容提取的准确性</li>
        </ol>
        <h2 id="测试策略"><a aria-hidden="true" tabindex="-1" href="#测试策略" class="anchor"><span class="icon icon-link"></span></a>测试策略</h2>
        <ol>
          <li>
            <p><strong>单元测试</strong>：</p>
            <ul>
              <li>URL 过滤功能测试</li>
              <li>Markdown 格式化测试</li>
              <li>章节分组逻辑测试</li>
              <li>正文提取算法测试</li>
            </ul>
          </li>
          <li>
            <p><strong>集成测试</strong>：</p>
            <ul>
              <li>使用本地测试服务器进行 sitemap 解析测试</li>
              <li>页面内容提取测试（标准模式和全文模式）</li>
              <li>完整生成流程测试</li>
            </ul>
          </li>
          <li>
            <p><strong>边界情况测试</strong>：</p>
            <ul>
              <li>空 sitemap 处理</li>
              <li>无效 URL 处理</li>
              <li>超大 sitemap 处理</li>
              <li>各种特殊字符和 Unicode 字符测试</li>
              <li>JavaScript 生成的动态内容测试</li>
            </ul>
          </li>
        </ol>
        <h2 id="后续扩展"><a aria-hidden="true" tabindex="-1" href="#后续扩展" class="anchor"><span class="icon icon-link"></span></a>后续扩展</h2>
        <ol>
          <li><strong>缓存支持</strong>：添加本地缓存，避免重复请求相同页面</li>
          <li><strong>更多输出格式</strong>：支持输出为其他格式（如 CSV、JSON 等）</li>
          <li><strong>自定义模板</strong>：支持用户自定义输出模板</li>
          <li><strong>网站内容深度分析</strong>：提取更多信息，如关键词、主题等</li>
          <li><strong>内容优化</strong>：添加内容过滤和优化功能，如删除广告、压缩内容等</li>
          <li><strong>支持更多站点结构</strong>：除了 sitemap.xml，支持从其他源（如 robots.txt、网站地图页面等）获取 URL</li>
        </ol>
        <h2 id="使用场景"><a aria-hidden="true" tabindex="-1" href="#使用场景" class="anchor"><span class="icon icon-link"></span></a>使用场景</h2>
        <ol>
          <li><strong>AI 开发者</strong>：收集网站内容用于训练或微调语言模型</li>
          <li><strong>文档管理</strong>：生成网站内容的结构化摘要</li>
          <li><strong>内容审计</strong>：快速获取网站的页面标题和描述列表</li>
          <li><strong>SEO 分析</strong>：分析网站的标题和描述标签质量</li>
          <li><strong>内容存档</strong>：将网站内容保存为本地 Markdown 文档</li>
        </ol>
      </markdown-style>
    </div>
    <script src="js/demo-preview.js?v=1.34.1"></script>
    <div class="footer warpper" style="max-width:720px;">Copyright © 2025 <a href="https://github.com/samzong" target="_blank">samzong</a><br></div>
    <script src="js/tocbot.js?v=1.34.1"></script>
  </body>
</html>
